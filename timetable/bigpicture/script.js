var classes = {
    "class": [
        "Homeroom",
        "M4 Meeting",
        "M.I.A.",
        "Thai",
        "Art",
        "Lunch",
        "F. English",
        "DClass",
        "Chemistry",
        "DClass",
        "",
    
        "Homeroom",
        "Earth Space",
        "DClass",
        "Chemistry",
        "F. Biology",
        "Lunch",
        "Physics",
        "S.I.A.",
        "Social",
        "Badminton",
        "EP Meeting",
    
        "Homeroom",
        "Earth Space",
        "F. Math",
        "DClass",
        "A. Math",
        "Lunch",
        "I. Study",
        "Comm. Eng",
        "Physics",
        "DClass",
        "",
    
        "Homeroom",
        "Chinese",
        "F. Biology",
        "DClass",
        "Lunch",
        "Counselling Activities",
        "DClass",
        "",
        "",
        "",
        "",
    
        "Homeroom",
        "E.I.A.",
        "DClass",
        "Social",
        "Health",
        "Lunch",
        "A. Math",
        "DClass",
        "Thai",
        ""
    ],
    "links": {
        "Homeroom": {
            "subjname": "Homeroom",
            "subjcode": "",
            "teacher": "ชุติมา สุขเอี่ยม",
            "classcode": "",
            "videocall": "",
            "classroom": ""
        },
        "M4 Meeting": {
            "subjname": "M4 Meeting",
            "subjcode": "",
            "teacher": "ระดับชั้น ม.4",
            "classcode": "",
            "videocall": "",
            "classroom": ""
        },
        "M.I.A.": {
            "subjname": "Math for International Achievement",
            "subjcode": "ค31253",
            "teacher": "กฤชพล บุญพูลมี",
            "classcode": "6izduw2",
            "videocall": "",
            "classroom": "NjA5NTc2MjM2MTU3"
        },
        "Thai": {
            "subjname": "Thai",
            "subjcode": "ท31101",
            "teacher": "สุภาภรณ์ ขวัญสุวรรณ",
            "classcode": "np5leqz",
            "videocall": "",
            "classroom": "NjA5NTkwNDgyMTgz"
        },
        "Art": {
            "subjname": "Art",
            "subjcode": "ศ31101",
            "teacher": "รัชนู พิมพิทักษ์",
            "classcode": "",
            "videocall": "",
            "classroom": ""
        },
        "F. English": {
            "subjname": "Fundamental English",
            "subjcode": "อ31151",
            "teacher": "Ramces M. Dili",
            "classcode": "udnafon",
            "videocall": "",
            "classroom": "NjA5NTM3NjY0NTM0"
        },
        "Chemistry": {
            "subjname": "Chemistry",
            "subjcode": "ว31125",
            "teacher": "ธันฐภัทร บุญช่วย",
            "classcode": "",
            "videocall": "",
            "classroom": ""
        },
        "Earth Space": {
            "subjname": "Earth and Space",
            "subjcode": "ว30165",
            "teacher": "ณัฐริกา รอดสถิตย์",
            "classcode": "ymfvwts",
            "videocall": "",
            "classroom": "NjA5NTE3NDI4NTE4"
        },
        "F. Biology": {
            "subjname": "Fundamental Biology",
            "subjcode": "ว31145",
            "teacher": "ธนกร อรรจนาวัฒน์",
            "classcode": "",
            "videocall": "",
            "classroom": ""
        },
        "Physics": {
            "subjname": "Physics",
            "subjcode": "ว31105",
            "teacher": "นิรุทธ์ พรมบุตร",
            "classcode": "5mpkvxs",
            "videocall": "",
            "classroom": "NjA5NTE2NDA1MDM2"
        },
        "S.I.A.": {
            "subjname": "Science for International Achievement",
            "subjcode": "ว31273",
            "teacher": "นิรุทธ์ พรมบุตร",
            "classcode": "5mpkvxs",
            "videocall": "",
            "classroom": "NjA5NTE2NDA1MDM2"
        },
        "Social": {
            "subjname": "Social",
            "subjcode": "ส31151",
            "teacher": "มาร์ช อุกฤษณ์ / นิว ธราดล",
            "classcode": "fclrxsv",
            "videocall": "efv-igth-qip",
            "classroom": "NTIwMDMzMTQyMjMx"
        },
        "Badminton": {
            "subjname": "Badminton",
            "subjcode": "พ30233",
            "teacher": "ทวีศักดิ์ พรหมแก้ว",
            "classcode": "2tld3ml",
            "videocall": "",
            "classroom": ""
        },
        "EP Meeting": {
            "subjname": "EP Meeting",
            "subjcode": "",
            "teacher": "",
            "classcode": "",
            "videocall": "",
            "classroom": ""
        },
        "F. Math": {
            "subjname": "Fundamental Math",
            "subjcode": "ค31151",
            "teacher": "กฤชพล บุญพูลมี",
            "classcode": "liwxlwd",
            "videocall": "",
            "classroom": "NjA5NTc2MTEzNTcx"
        },
        "A. Math": {
            "subjname": "Additional Math",
            "subjcode": "ค31251",
            "teacher": "กฤษฎา อัศวสกุลเกียรติ",
            "classcode": "deki6v5 (Gmail)",
            "videocall": "",
            "classroom": "NTIzMTUxNDM5MzI0"
        },
        "I. Study": {
            "subjname": "Independent Study",
            "subjcode": "I31251",
            "teacher": "เอกราช สุขเสริม",
            "classcode": "omazijx",
            "videocall": "hcp-dtmt-tmr",
            "classroom": "NTE5ODE5MjM0MTA1"
        },
        "Comm. Eng": {
            "subjname": "Communicational in English",
            "subjcode": "อ31251",
            "teacher": "Ramces M. Dili",
            "classcode": "votutta",
            "videocall": "",
            "classroom": "NTIwMDQyNzkxNDY2"
        },
        "Chinese": {
            "subjname": "Chinese",
            "subjcode": "จ31251",
            "teacher": "ธัญญภัสร์ เจริญพร",
            "classcode": "",
            "videocall": "",
            "classroom": ""
        },
        "Japanese": {
            "subjname": "Japanese",
            "subjcode": "ญ31251",
            "teacher": "ดรัณภพ กัญญาศักดิ์",
            "classcode": "6uulgjc",
            "videocall": "",
            "classroom": "NTIyNTcxNDU2MzQ2"
        },
        "Counselling Activities": {
            "subjname": "Counselling Activities",
            "subjcode": "ก31903",
            "teacher": "วรางคณา มุ่งมาตร์มิตร",
            "classcode": "trmwn77",
            "videocall": "afw-jjes-jcf",
            "classroom": "NTIwMDQwNzIxMzQ5"
        },
        "E.I.A.": {
            "subjname": "English for International Achievement",
            "subjcode": "อ31253",
            "teacher": "โชกศรัณต์​ เศรษฐาศุภวัฒน์",
            "classcode": "en7acxt",
            "videocall": "",
            "classroom": "NTE5ODE5MTM1NTAy"
        },
        "Health": {
            "subjname": "Health",
            "subjcode": "พ31101",
            "teacher": "รุสมัน มะนอ",
            "classcode": "fvqujrp",
            "videocall": "",
            "classroom": "NTIwMDYyNjkxMTAy"
        },
        "Lunch": {
            "subjname": "Lunch",
            "subjcode": "",
            "teacher": "",
            "classcode": "",
            "videocall": "",
            "classroom": ""
        },
        "Break": {
            "subjname": "Break",
            "subjcode": "",
            "teacher": "",
            "classcode": "",
            "videocall": "",
            "classroom": ""
        },
        "DClass": {
            "subjname": "DClass",
            "subjcode": "",
            "teacher": "",
            "classcode": "",
            "videocall": "",
            "classroom": ""
        },
        "": {
            "subjname": "",
            "subjcode": "",
            "teacher": "",
            "classcode": "",
            "videocall": "",
            "classroom": ""
        }
    }
}

var classtime_type = "Regular"
var classtimes = {
    "Regular": {
        "notify": false,
        "list": [
            "08:00 — 08:30",
            "08:30 — 09:20",
            "09:20 — 10:10",
            "10:10 — 11:00",
            "11:00 — 11:50",
            "11:50 — 12:40",
            "12:40 — 13:30",
            "13:30 — 14:20",
            "14:20 — 15:10",
            "15:10 — 16:00",
            "16:00 — 16:50"
        ],
        "timeremaining": {
            "periodperday": 10,
            "periodlength": 50,
            "starthour": 7,
            "startmin": 40,
        }
    },
    "Special": {
        "notify": true,
        "list": [
            "08:00 — 08:30",
            "08:30 — 09:10",
            "09:10 — 09:50",
            "09:50 — 10:30",
            "10:30 — 11:10",
            "11:10 — 11:50",
            "11:50 — 12:30",
            "12:30 — 13:10",
            "13:10 — 13:50",
            "13:50 — 14:30",
            "14:30 — 15:10"
        ],
        "timeremaining": {
            "periodperday": 10,
            "periodlength": 40,
            "starthour": 7,
            "startmin": 50,
        }
    },
    "Online": {
        "notify": false,
        "list": [
            "08:00 – 08:40",
            "08:40 – 09:20",
            "09:20 – 10:00",
            "10:20 – 11:00",
            "11:00 – 11:40",
            "12:00 – 12:40",
            "12:40 – 13:20",
            "13:40 – 14:20",
            "14:20 – 15:00",
            "15:20 – 16:00",
            "16:00 – 16:40"
        ],
        "timeremaining": {
            "periodperday": 10,
            "periodlength": 50,
            "starthour": 7,
            "startmin": 40,
        }
    },
}

// Public variables
var timeleftinterval = undefined
var bellChimes = new Audio("/timetable/assets/sound/bellChimes.mp3")

// Set variables.
var periodTimeLeft = classtimes[classtime_type]["timeremaining"];
var periodperday = periodTimeLeft["periodperday"];
var periodlength = periodTimeLeft["periodlength"];
var starthour = periodTimeLeft["starthour"];
var startmin = periodTimeLeft["startmin"];

// Calculated every 1 second.
timeleftinterval = setInterval(() => {
    var curtimeM = (hour * 60) + minute;
    var curtimeS = (curtimeM * 60) + second;

    var endtime = ((starthour * 60) * 60) + (startmin * 60);
    var timediff = endtime - curtimeS;

    var periodno = -1;

    while (timediff < 0) {
        var timediff = timediff + (periodlength * 60);
        var periodno = periodno + 1;
    }

    var rseconds = timediff % 60;
    var rminutes = Math.floor(timediff / 60);

    if (periodno >= 0 && periodno <= periodperday) {
        var classtofetch = classes.links[classes.class[((today.getDay() - 1) * 11) + (periodno)]].subjname

        if (classtofetch == "DClass") {
            classtofetch = classes.links[classes.class[(((today.getDay() - 1) * 11)) + (periodno)]].subjname
        }

        document.getElementById("subjname").innerHTML = classtofetch

        // ------------------------------------------------------------------

        // document.getElementById("period").innerHTML = periodno
        document.getElementById("timeremaining-refreshcontent").innerHTML = `Period ${periodno} - ${rminutes >= 10 ? rminutes : "0" + rminutes}:${rseconds >= 10 ? rseconds : "0" + rseconds}`;

        // Check if period ends (hour and minutes = 0)
        if ((rminutes == 0) && (rseconds == 0)) {
            // If sound setting is enabled, play the sound.
            if (localStorage.getItem("timetable-enableTimeRemainingSound") === "true") {
                bellChimes.play();
            }
        } 
    }
    if (periodno <= 0) {
        document.getElementById("timeremaining-refreshcontent").innerHTML = `Day Start`;
    }
    if (periodno > periodperday) {
        document.getElementById("timeremaining-refreshcontent").innerHTML = `Day End`;
    }
}, 1000);